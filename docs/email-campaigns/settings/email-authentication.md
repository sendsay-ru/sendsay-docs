---
sidebar_position: 3
sidebar_label: 'Email-аутентификация'
---

import Details from '@theme/Details';
import dkim from '/img/email-campaigns/settings/email-authentication/dkim.png';

# Из чего состоит email-аутентификация

Настройка DKIM-подписи, SPF-записи и DMARC-политики — это части процесса email-аутентификации. Про неё у нас есть большая основная статья, которая подробно объясняет, зачем она нужна и как её настраивать.

[Как подключить домен и настроить email-аутентификацию](https://docs.sendsay.ru/email-campaigns/settings/how-to-connect-domain) <br/>

## DKIM-подпись

Подключение домена заключается в настройке DKIM-подписи — это зашифрованная подпись, с помощью которой почтовый сервис проверяет:

- письмо пришло от домена, который имеет право его отправлять,
- по пути к получателю письмо не было изменено.

DKIM состоит из двух ключей: приватного (хранится в Sendsay) и публичного (находится в DNS). При отправке письма Sendsay создаёт DKIM-подпись и размещает её в технической части письма, а почтовый сервис при получении проверяет подпись на подлинность.

[Как самостоятельно подключить домен и настроить DKIM-подпись](https://docs.sendsay.ru/email-campaigns/settings/how-to-connect-domain#как-самостоятельно-подключить-домен)

## SPF-запись

SPF-запись — это запись в DNS, где перечислены домены и IP-адреса серверов, которые могут отправлять почту от имени вашего домена. Почтовый сервис при получении письма проверяет, с какого адреса оно отправлено, — речь при этом идёт не об адресе отправителя, который видит пользователь, а о техническом адресе, с которого уходят письма.

### Как самостоятельно настроить SPF-запись

Для самостоятельного подключения SPF-записи:

1. Перейдите в редактор DNS-зоны вашего домена. Если у вас нет доступа к редактированию DNS-записей, обратитесь к вашему системному администратору.
2. Добавьте SPF-запись:
   - если у вас уже есть SPF-запись в домене `mail.ваш_домен.ru`, добавьте в неё запись `include:spf.sendsay.ru`,
   - если SPF-записи нет, создайте в домене `ваш_домен.ru` новую запись типа `TXT`. В качестве имени укажите `@`, а в поле значения скопируйте запись:<br/><br/>
   ```
   v=spf1 include:spf.sendsay.ru ~all
   ```

## DMARC-политика

Сами по себе ни DKIM, ни SPF не защищают от злоумышленников — если письмо не пройдёт эти проверки, почтовые сервисы всё равно пропустят его в ящик получателя или максимум отправят в папку «Спам».

Для защиты от злоумышленников к DKIM-подписи стоит добавить DMARC-политику — это запись в DNS, которая определяет, что делать с письмами, которые в том числе не прошли DKIM-проверку. Есть три варианта:

- отклонять (reject),
- отправлять в папку «Спам» (quarantine),
- пропускать в почтовые ящики письма (none).

Мы не рекомендуем сразу отклонять все письма, которые не прошли проверку, потому что этот вариант может заблокировать ваши рассылки из других источников (например, из CRM-систем), а также подписчики не смогут пересылать ваши письма друг другу. Лучше использовать более свободную политику и отслеживать ежедневные статистические отчёты — они приходят на указанный адрес при любой DMARC-политике.

В отчётах будут содержаться результаты проверки по всем IP-адресам, с которых производилась рассылка писем от имени вашего домена. Если вы обнаружите там подозрительные адреса, стоит провести проверку и на время изменить значение DMARC-политики на более жёсткую, чтобы оградить клиентов от возможных злоумышленников.

### Как самостоятельно настроить DMARC-политику

Для самостоятельного подключения DMARC-политики:

1. Перейдите в редактор DNS-зоны вашего домена. Если у вас нет доступа к редактированию DNS-записей, обратитесь к вашему системному администратору.
2. На странице редактирования DNS-настроек добавьте новую запись с типом `TXT`:

- Имя — `_dmarc.имя_домена.ru`, где `имя_домена` — ваш домен.
- Значение — `v=DMARC1; p=none; rua=mailto:postmaster@your.tld`.

Чтобы проверить настройки, отправьте себе тестовую копию рассылки на адрес, который находится на любом основном почтовом сервисе (Яндекс, Mail, Gmail). Если письмо пришло, значит, всё работает.

<Details summary='Только для продвинутых пользователей'> 
При отправке email-рассылки на шаге **Письмо** можно протестировать настройки DMARC-политики домена, указав DKIM-подпись, отличную от подписи по умолчанию.
<img src={dkim} />

</Details>

## Дополнительная настройка

Дополнительная настройка включает в себя следующие параметры домена:

- **Mail from** — технический обратный адрес, на который поступают дополнительные отчёты о доставке/недоставке рассылки (не путайте с адресом отправителя, который видит подписчик).
- **Feedback Loop (FBL)** — стандарт выдачи информации о жалобах на спам от провайдера услуг электронной почты.
- **Отслеживание ссылок** — настройка домена, которая поможет учитывать переходы по ссылкам из письма в статистике.
- **List-Unsubscribe** — адрес, куда приходят автоматические письма от подписчиков, которые нажали «Отписаться» в почтовых сервисах.
- **Relay** — набор IP-адресов, который используется для отправки рассылок с домена (по умолчанию используются общие для всех клиентов адреса).
- **Callback** — адрес, куда отправляется статистика по выпускам домена (например, открытия, переходы по ссылке, отписки).

Есть 2 способа настройки дополнительных параметров:

- делегировать нам поддомен для настройки — и мы всё сделаем за вас,
- передать инструкцию по настройке вашему техническому специалисту.

В обоих случаях напишите в службу поддержки через чат на сайте или на почту ask@sendsay.ru — и мы выставим счёт, либо передадим инструкцию для вашего технического специалиста.

**Читайте также:** [Как передать права на управление поддоменом](https://docs.sendsay.ru/email-campaigns/settings/how-to-delegate-subdomain)
