---
sidebar_position: 2
---

import browseAbandonment from "/img/automations/automations-by-behaviour/browse-abandonment/browse-abandonment.png";
import legacyInterface from "/img/automations/automations-by-behaviour/browse-abandonment/legacy-interface.png";
import howToAddYml from "/img/automations/automations-by-behaviour/browse-abandonment/how-to-add-yml.png";
import ymlUpdate from "/img/automations/automations-by-behaviour/browse-abandonment/yml-update.png";
import templateRestrictions from "/img/automations/automations-by-behaviour/browse-abandonment/add-restrictions-to-the-template.png";
import segmentId from "/img/automations/automations-by-behaviour/browse-abandonment/segment-id.png";

# Как настроить автоматизацию «Брошенный просмотр»

Брошенный просмотр — это автоматизация, которая предлагает посетителям сайта купить что-нибудь из просмотренных товаров, если их так и не добавили в корзину. Это увеличивает конверсию, так как вы отправляете именно те товары, которые уже возможно заинтересовали подписчиков.

<p align="center">
    <img src={browseAbandonment} alt="Browse abandonment" />
</p>

Важно отметить, что брошенный просмотр будет работать только для тех подписчиков, чью активность мы можем отследить на сайте. Это возможно в двух случаях:

- если подписчик хотя бы один раз перешёл на сайт по ссылке из письма, отправленного через Sendsay,
- если вы передадите нам электронные адреса в отдельном запросе (ниже расскажем, как это сделать).

Настройка автоматизации проходит в шесть шагов:

## 1. Загрузите каталог товаров в Sendsay

:::tip Важно
Если в аккаунте уже настроены автоматизации «Брошенная корзина» или «Товарные рекомендации», этот шаг можно пропустить
:::

### Подготовьте файл со списком товаров

Прежде всего нужно подготовить каталог товаров, чтобы загрузить его в Sendsay и добавлять товары оттуда в рассылку. Для этого нужно создать текстовый файл в формате .yml и добавить туда всю информацию о товарах:

- id,
- наименование,
- стоимость,
- ссылка на фотографию и так далее.

Выглядеть файл будет вот так:

```
<offer id="123" type="vendor.model" available="true" bid="1" group_id="136010368">
  <url>http://www.xxxxxx.ru/xxxx</url>
  <price>1749.0000</price>
  <currencyId>RUR</currencyId>
  <caategoryId>490</categoryId>
  <market_category>Дом и дача/Дом и интерьер/Текстиль Шторы</market_category>
 <picture>http://media.xxxxx.xx/products/641by641/13/60/10/XXXXXXXXXXXXXX.jpg</picture>
  <delivery>true</delivery>
  <local_delivery_cost>0</local_delivery_cost>
  <typePrefix>Шторы, занавески</typePrefix>
  <vendor>La Interieurs</vendor>
  <vendorCode>136010368</vendorCode>
  <model>Занавеска с вышивкои по низу</model>
  <description>- Качество VALEUR SURE. Качественная отделка. Со сборкои 60 мм (3 варианта высоты). 91% полиэстера, 9% льна. Красивая вышивка по низу. Простои уход: стирка при 40°, не нужно гладить. Расстояние от отделки до низа 30 см (для размеров 240 и 260 см). Размер в см.</description>
  <sales_notes>Минимальный заказ 1500 руб</sales_notes>
  <manufacturer_warranty>true</manufacturer_warranty>
  <param name="country_of_origin">Франция</param>
  <param name="Пол">OTHER</param>
  <param name="Возраст">OTHER</param>
  <param name="Цвет">белый</param>
  <param name="Размер" unit="FR">240 x 175 см</param>
</offer>
```

Готовый файл нужно загрузить на общедоступный сервер без логина и пароля.

### Создайте автоматизацию для обновления списка товаров

Чтобы подписчики не получали устаревшие предложения, данные о товарах в Sendsay должны периодически обновляться. Это можно сделать с помощью автоматического импорта, который настраивается [в предыдущей версии интерфейса Sendsay](https://sendsay.ru/account/). В неё можно перейти и в самом аккаунте — для этого нажмите на свой адрес (справа от журнала заданий) и в меню выберите пункт «Предыдущий интерфейс»:

<p align="center">
    <img src={legacyInterface} alt="Legacy interface" />
</p>

В предыдущем интерфейсе нужно создать действие по расписанию:

1. Откройте раздел **Система → Действия по расписанию**.
2. В выпадающем меню вместо «Выпуск по расписанию» выберите пункт «Импорт из YML» и нажмите «Создать».
3. Заполните название действия («Брошенный просмотр») и укажите ссылку на файл.
4. Нажмите «Сохранить и активировать».
5. Дождитесь загрузки данных — данные будут обновляться три раза в сутки (по умолчанию в 7:00, 15:00 и 23:00 по московскому времени).

<p align="center">
    <img src={howToAddYml} alt="How to add YML" />
</p>

## 2. Настройте передачу данных с сайта

:::tip Важно
Если в аккаунте уже настроены автоматизации «Брошенная корзина» или «Товарные рекомендации», этот шаг можно пропустить
:::

Чтобы идентифицировать товары, которые нужно выводить в письме, на страницы сайта нужно добавить специальный скрипт. Он находится в предыдущем интерфейсе — перейдите в раздел **Система → Настройки** и раскройте вкладку **Basket script**.

<p align="center">
    <img src={ymlUpdate} alt="YML update" />
</p>

Скрипт нужно вставить на каждую страницу с товаром — например, если у вас в разделе товаров 20 наименований, скрипт надо добавить на все 20 страниц. Скопируйте его в html-код перед закрывающим тегом `</body>` (на виде страниц это не отразится).

## 3. Создайте шаблон письма

Откройте раздел Контент и создайте шаблон рассылки.

[Как создать письмо в блочном редакторе](/docs/email-campaigns/create-your-campaign/drag-and-drop-editor.md)

[Как загрузить HTML-шаблон](/docs/email-campaigns/create-your-campaign/how-to-upload-html-template.md)

С брошенным просмотром стоит быть аккуратным, чтобы не перенасытить пользователя напоминаниями и не присылать ему письма с товарами слишком часто. Поэтому при создании шаблона стоит поставить ограничение — письмо не будет отправляться подписчикам, которые уже получали от вас рассылки за выбранный период. Для этого в блоке **Действия с получателями** поставьте галочку «Подписчики, получившие много писем» и укажите период.

<p align="center">
    <img src={templateRestrictions} alt="Add restrictions to the template" />
</p>

Чтобы вставить таблицу с брошенными товарами, вставьте в текст шаблона следующий код:

```
[% external_extra('ссылка на ваш yml-файл','format','yml') %]
[% FOREACH ymldata IN anketa.sendsay_pageviews %]
   [% IF ymldata.ymlurl == 'ссылка на ваш yml-файл' %]
      [% FOREACH id IN ymldata.last10 %]
             [% yml.$id.model %]
         [% LAST IF loop.count() == 3 %]
      [% END %]
   [% END %]
[% END %]
```

Также можно отредактировать количество товаров, которые будут выводиться в письме (по умолчанию их три). Для этого нужно изменить число в параметре `loop.count ()` — вы можете задать любое значение до 10 (это максимум для одного письма).

После редактирования шаблона сохраните изменения.

## 4. Создайте сегмент для подписчиков с брошенным просмотром

### 1. Создайте сегмент

1. Зайдите в раздел **Подписчики → Сегменты**.
2. Нажмите на синюю кнопку «Создать сегмент».
3. Введите название и выберите тип контактов «Email».
4. Нажмите «Создать сегмент».
5. Скопируйте id сегмента — он отображается в адресной строке браузера.

<p align="center">
    <img src={segmentId} alt="Segment ID" />
</p>

### 2. Задайте условия сегмента

1. Откройте API-консоль — её иконка находится на боковой панели сайта прямо над справочным центром.
2. Отправьте следующий API-запрос:

```
{
  "action": "group.filter.set",
  "id": "id сегмента",
  "filter": [
    {
      "a": "size(sendsay_pageviews)",
      "v": "0",
      "op": ">"
    }
  ]
}
```

## 5. Протестируйте, всё ли работает

1. Отправьте себе тестовое письмо со ссылкой на сайт. Перейдите из письма на сайт, откройте несколько товаров и закройте сайт.
2. В Sendsay перейдите в предыдущий интерфейс и откройте свою карточку подписчика. Если всё настроено правильно, там появится новая сущность `sendsay_pageviews`, где будут храниться id просмотренных товаров.
3. Чтобы протестировать, как товары из брошенного просмотра выглядят в письме, откройте созданный шаблон и войдите в режим предпросмотра. Сбоку выберите пункт «Посмотреть письмо с данными конкретного подписчика» и вставьте свой адрес — товары должны отображаться в письме.

## 6. Создайте автоматизацию

Перейдите в раздел **Автоматизации → По времени** и нажмите «Создать автоматизацию». Появится окно с выбором типа автоматизации — выберите «Автоматизация рассылки». Затем:

1. В пункте «Письмо для рассылки» выберите шаблон письма с брошенным просмотром.
2. Выберите сегмент подписчиков с брошенным просмотром.
3. Настройте расписание, когда вы хотите отправлять письмо.
4. Нажмите «Сохранить» (в правом нижнем углу).
5. Нажмите «Активировать» (в правом верхнем углу).

![Create browse abandonment automation](/img/automations/automations-by-behaviour/browse-abandonment/create-browse-abandonment-automation.gif)
