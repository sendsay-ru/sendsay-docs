---
sidebar_position: 1
---

import abandonedCart from "/img/automations/automations-by-behaviour/abandoned-cart/abandoned-cart.png";
import legacyInterface from "/img/automations/automations-by-behaviour/abandoned-cart/legacy-interface.png";
import howToAddYml from "/img/automations/automations-by-behaviour/abandoned-cart/how-to-add-yml.png";
import ymlUpdate from "/img/automations/automations-by-behaviour/abandoned-cart/yml-update.png";
import abandonedCartTemplate from "/img/automations/automations-by-behaviour/abandoned-cart/abandoned-cart-template.png";
import step1 from "/img/automations/automations-by-behaviour/abandoned-cart/abandoned-cart-step-1.png";
import step2 from "/img/automations/automations-by-behaviour/abandoned-cart/abandoned-cart-step-2.png";
import step3 from "/img/automations/automations-by-behaviour/abandoned-cart/abandoned-cart-step-3.png";
import dataUpdate from "/img/automations/automations-by-behaviour/abandoned-cart/data-update.png";
import abandonedCartSegment from "/img/automations/automations-by-behaviour/abandoned-cart/abandoned-cart-segment.png";

# Как настроить автоматизацию «Брошенная корзина»

:::tip Важно
Подключение автоматизации приостановлено. В ближайшее время вы сможете настроить сценарий Брошенная корзина в новом модуле Sendsay Продажи — оставьте заявку, чтобы получить ранний доступ к новым возможностям. [Подробнее](https://app.sendsay.ru/ecom)

Ранее настроенные автоматизации продолжают работать.
:::

Брошенная корзина — это автоматизация, которая отслеживает у посетителей сайта оставленные в корзине товары и отправляет письма с напоминаниями о них. Это увеличивает конверсию, так как письма уходят уже заинтересованным в покупке подписчикам, и вы отправляете им именно те товары, которые им нужны.

<p align="center">
    <img src={abandonedCart} alt="Abandoned cart" />
</p>

Важно отметить, что брошенная корзина будет работать только для тех подписчиков, чью активность мы можем отследить на сайте. Это возможно в двух случаях:

- если подписчик хотя бы один раз перешёл на сайт по ссылке из письма, отправленного через Sendsay,
- если вы передадите нам электронные адреса в отдельном запросе (ниже расскажем, как это сделать).

Подключить «Брошенную корзину» можно только [в предыдущей версии интерфейса Sendsay](https://sendsay.ru/account/). В неё можно перейти и в самом аккаунте — для этого нажмите на свой адрес (справа от журнала заданий) и в меню выберите пункт «Предыдущий интерфейс»:

<p align="center">
    <img src={legacyInterface} alt="Legacy interface" />
</p>

Подключение брошенной корзины проходит в шесть шагов:

## 1. Загрузите каталог товаров в Sendsay

Важно: если в аккаунте уже настроены автоматизации «Брошенный просмотр» или «Товарные рекомендации», этот шаг можно пропустить.

### Подготовьте файл со списком товаров

Чтобы добавлять товары из корзины в рассылку, нужно загрузить весь каталог в Sendsay — оттуда будут подгружаться цены, описания и фотографии товаров. Для этого нужно создать текстовый файл в формате .yml и добавить туда всю информацию о товарах:

- id,
- наименование,
- стоимость,
- ссылка на фотографию и так далее.

Выглядеть файл будет вот так:

<!-- prettier-ignore -->
```html
<offer id="123" type="vendor.model" available="true" bid="1" group_id="136010368">
  <url>http://www.xxxxxx.ru/xxxx</url>
  <price>1749.0000</price>
  <currencyId>RUR</currencyId>
  <caategoryId>490</categoryId>
  <market_category>Дом и дача/Дом и интерьер/Текстиль Шторы</market_category>
 <picture>http://media.xxxxx.xx/products/641by641/13/60/10/XXXXXXXXXXXXXX.jpg</picture>
  <delivery>true</delivery>
  <local_delivery_cost>0</local_delivery_cost>
  <typePrefix>Шторы, занавески</typePrefix>
  <vendor>La Interieurs</vendor>
  <vendorCode>136010368</vendorCode>
  <model>Занавеска с вышивкои по низу</model>
  <description>- Качество VALEUR SURE. Качественная отделка. Со сборкои 60 мм (3 варианта высоты). 91% полиэстера, 9% льна. Красивая вышивка по низу. Простои уход: стирка при 40°, не нужно гладить. Расстояние от отделки до низа 30 см (для размеров 240 и 260 см). Размер в см.</description>
  <sales_notes>Минимальный заказ 1500 руб</sales_notes>
  <manufacturer_warranty>true</manufacturer_warranty>
  <param name="country_of_origin">Франция</param>
  <param name="Пол">OTHER</param>
  <param name="Возраст">OTHER</param>
  <param name="Цвет">белый</param>
  <param name="Размер" unit="FR">240 x 175 см</param>
</offer>
```

Готовый файл нужно загрузить на общедоступный сервер без логина и пароля.

### Добавьте файл в Sendsay

В разделе **Конверсии → Брошенная корзина** вставьте в поле ссылку на yml-файл и нажмите «Создать сущности для брошенной корзины».

<p align="center">
    <img src={howToAddYml} alt="How to add YML" />
</p>

### Создайте автоматизацию для обновления списка товаров

Чтобы подписчики не получали устаревшие предложения, данные о товарах в Sendsay должны периодически обновляться. Это можно сделать с помощью автоматического импорта, который настраивается в предыдущем интерфейсе:

1. Откройте раздел **Система → Действия по расписанию**.
2. В выпадающем меню вместо «Выпуск по расписанию» выберите пункт «Импорт из YML» и нажмите «Создать».
3. Заполните название действия («Брошенная корзина») и укажите ссылку на файл.
4. Нажмите «Сохранить и активировать».
5. Дождитесь загрузки данных — данные будут обновляться три раза в сутки (по умолчанию в 7:00, 15:00 и 23:00 по московскому времени).

<p align="center">
    <img src={ymlUpdate} alt="YML update" />
</p>

## 2. Настройте шаблон письма и при надобности отредактируйте автоматизацию

В разделе **Конверсии → Брошенная корзина** у вас теперь выводятся шаблон письма и две автоматизации для брошенной корзины:

### Шаблон письма

Это шаблон с кодом, который добавляет в письмо таблицу с брошенными товарами (по умолчанию выводятся три товара). Вы можете отредактировать внешний вид письма, а также отредактировать количество товаров, изменив число в параметре count:

<p align="center">
    <img src={abandonedCartTemplate} alt="Abandoned cart template" />
</p>

Вот исходный код для шаблона:

<!-- prettier-ignore -->
```html
<!-- text_pro_editor -->
		[% external_extra("ТУТ УРЛ YML","method","get","format","yml") %]
		[% i=1 %]
		[% count = 3 %]
		<table border=0 width=100%>
		[% FOREACH item IN anketa.sendsay_basket.items.values() %]
			[% IF i == 1 %]
		  		<tr>
		    [% END %]
		          <td width=33% align="center">[% id = item.id %]<a href="[% yml.$id.url %]"><img width=150 src="[% IF yml.$id.picture[0] %][% yml.$id.picture[0] %][% ELSE %][% yml.$id.picture %][% END %]"/><br><br><b>[% yml.$id.model %]</b></a><br><br>[% yml.$id.price %] ₽</td>
			[% IF i == count %]</tr>[% i=1 %]
			[% ELSIF i < count AND loop.last() %]
			[% x = i %]
			[% WHILE x < count %]
				<td></td>
				[% x=x+1 %]
			[% END %]
			</tr>
			[% ELSE %][% i=i+1 %]
			[% END %]
		[% END %]
		</table>
```

После редактирования шаблона сохраните изменения.

### Автоматизация «Запуск/Остановка корзины при изменении»

Это вспомогательная автоматизация, которая отправляет подписчиков на основную последовательность «Брошенная корзина». Её не нужно редактировать, чтобы ничего не сломалось.

### Автоматизация «Брошенная корзина»

Это основная автоматизация, в результате которой подписчикам отправляются письма с напоминаниями о товарах. Объясним, из каких шагов она состоит, на случай если вы захотите отредактировать порядок действий.

**Первый шаг.** Он нужен, чтобы на последовательность не могли попасть случайные подписчики — только из автоматизации «Запуск/Остановка».

<p align="center">
    <img src={step1} alt="Step 1" />
</p>

**Второй шаг.** Когда подписчик попал на последовательность, мы ждём час, чтобы посетитель сайта мог завершить заказ (вы можете задать больший или меньший интервал времени).

<p align="center">
    <img src={step2} alt="Step 2" />
</p>

**Третий шаг.** Происходит проверка данных:

- если у него есть товары в корзине (переменная basket items больше единицы), ему отправляется письмо,
- если корзина пуста, через 10 минут последовательность останавливается.

<p align="center">
    <img src={step3} alt="Step 3" />
</p>

Остальные шаги нужны в случае, если подписчик проигнорирует письмо, а в корзине по-прежнему что-то лежит. По умолчанию в сценарии есть одно дополнительное письмо, которое отправляется через один день, но вы можете настроить любое количество.

## 3. Настройте передачу данных с сайта

Чтобы идентифицировать товары, которые нужно выводить в письме, на каждую страницу с товаром нужно добавить специальный скрипт, который находится в разделе **Конверсии → Брошенная корзина** (например, если у вас в разделе товаров 20 наименований, скрипт надо добавить на все 20 страниц). Скопируйте его и добавьте в html-код перед закрывающим тегом `</body>` (на виде страницы это не отразится).

<p align="center">
    <img src={dataUpdate} alt="Data update" />
</p>

Также попросите программистов написать javascript-функции, чтобы сайт передавал нам данные о товарах в корзине пользователя.

1. Функция для обновления данных в корзине, чтобы получать актуальные товары:


```js
(function(){if(typeof sndsyApi != 'undefined'){sndsyApi.basketUpdate( [{ "id": <id товара>, "count": <количество> }, { "id": <id товара>, "count": <количество> }, { "id": <id товара>, "count": <количество> }] )}})();
```

1. Функция для обнуления корзины, который останавливает последовательность при покупке товаров:


```js
(function () {
  if (typeof window.sndsyApi == 'object') {
    sndsyApi.basketUpdate({});
  }
})();
```

1. Дополнительная функция для передачи электронных адресов со списком просмотренных товаров у подписчиков. Запрос позволяет передать информацию о подписчиках, чью активность на сайте вы можете отследить, а мы — нет (например, если подписчик не перешёл по ссылке из письма, но авторизовался в личном кабинете).
2. 

```js
(function(){if(typeof sndsyApi != 'undefined'){sndsyApi.basketUpdate( [{ "id": <id товара>, "count": <количество> }, { "id": <id товара>, "count": <количество> }, { "id": <id товара>, "count": <количество> }], { email: 'some@domain.com' } )}})();
```

## 4. Создайте сегмент для подписчиков с брошенной корзиной

Сегмент нужен просто для удобства — с его помощью можно следить, сколько у вас подписчиков с неочищенной корзиной.

### 1. Создайте сегмент

1. Зайдите в раздел **Подписчики → Группы** и нажмите кнопку «Создать группу».
2. Введите название и выберите тип группы «Фильтр».
3. Нажмите «Создать группу».
4. Скопируйте id сегмента — он отображается рядом с названием группы.

<p align="center">
    <img src={abandonedCartSegment} alt="Abandoned cart segment" />
</p>

### 2. Задайте условия сегмента

1. Откройте раздел **Система → API-консоль**.
2. Отправьте следующий API-запрос:

<!-- prettier-ignore -->
```js
{
  "action": "group.filter.set",
  "id": "id сегмента",
  "filter": [
    {
      "a": "size(sendsay_basket.items)",
      "v": "0",
      "op": ">"
    }
  ]
}
```

## 5. Протестируйте, всё ли работает

1. Отправьте себе тестовое письмо со ссылкой на сайт. Перейдите из письма на сайт, наберите корзину и закройте сайт, не оплачивая её.
2. В Sendsay перейдите в предыдущий интерфейс и откройте карточку подписчика. Если всё настроено правильно, там появится новая сущность basket (), где будут храниться id добавленных товаров.
3. Чтобы протестировать, как товары из брошенной корзины выглядят в письме, откройте созданный шаблон и войдите в режим предпросмотра. Сбоку выберите пункт «Посмотреть письмо с данными конкретного подписчика» и вставьте свой адрес — товары из корзины должны отображаться в письме.

## 6. Активируйте автоматизации

Теперь в разделе **Конверсии → Брошенная корзина** осталось активировать две последовательности, чтобы рассылка начала отправляться подписчикам:

1. Откройте автоматизацию «Запуск/Остановка» и нажмите «Активировать».
2. Откройте автоматизацию «Брошенная корзина» и нажмите «Активировать».
