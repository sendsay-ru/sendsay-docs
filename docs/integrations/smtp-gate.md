---
sidebar_position: 1
---

# Отправка рассылок через SMTP-гейт

## Что такое SMTP-гейт

SMTP-гейт – это способ передачи нам заданий на отправку писем через [SMTP-протокол](https://ru.wikipedia.org/wiki/SMTP). Если ваша система, которой нужно отправлять письма, уже умеет это делать через SMTP, использование SMTP-гейта существенно упростит интеграцию с Sendsay.

Отправка рассылок через SMTP-гейт обладает существенными ограничениями по сравнению с отправкой через Sendsay API.

## Как подключить SMTP-гейт

Для получения доступа к SMTP-гейту напишите в поддержку или вашему менеджеру. Вам зададут несколько вопросов о ваших рассылках и после этого выдадут параметры подключения.

Авторизация возможна как по логину-паролю, так и через закрепление IP-адресов, с которых будет происходить соединение и отправка писем.

Доступ к SMTP-гейту осуществляется через стандартный порт 25. Если вам требуется TLS-соединение, то вы также можете использовать 25-й порт, либо 587-й.

## Тестирование SMTP-гейта

Если у вас уже есть доступ к SMTP-гейту, вы можете отправлять письма на test@test.ru, они будут приниматься и игнорироваться. В статистике они также не появятся.

Если у вас нет еще доступа к SMTP-гейту, для тестирования соединения можно использовать следующие настройки:

- **Хост** — demo.gate.sendsay.ru
- **Логин** — demo.demo@smtpgate
- **Пароль** — demo

Письма, отправленные на любые адреса, уходить не будут.

## Email-аутентификация

Письма, отправляемые через SMTP-гейт, могут дополняться DKIM-подписью вашего домена. Для этого просто добавьте один или несколько доменов через личный кабинет.

Соответствующий домен для формирования DKIM-подписи будет выбираться в зависимости от домена адреса отправителя. Если подходящего домена не найдётся, то будет использован домен по умолчанию (при наличии такового).

Так как мы не изменяем используемый во входящей SMTP-сессии MAIL FROM, вы должны у домена, используемого в MAIL FROM, добавить нашу SPF-запись в настройках ДНС:

```
v=spf1 include:spf.sendsay.ru ~all
```

## Статистика рассылок через SMTP-гейт

Все письма, отправленные через SMTP-гейт, объединяются в выпуски в рамках суток. По каждому отправленному письму доступны все типы откликов: доставка, открытия, клики, отписки.

### X-Campaign-Id

Если вы хотите объединять в статистике письма по заранее известному признаку (например, по цели отправки), можно использовать email header `X-Campaign-Id`. Его значение может состоять из латинских букв, цифр и символов "\_" и "-".

Значение `X-Campaign-Id` будет назначено параметру issue.name

### X-Letter-Id

Также каждому отправленному письму можно присвоить собственный идентификатор, используя email header `X-Letter-Id`. Его значение может состоять из латинских букв, цифр и символов "\_" и "-".

Значение `X-Letter-Id` будет возвращено в коллбэках в параметре `gate.uniq`.

## Особенности отправки рассылок через SMTP-гейт

Отправляемое к нам письмо должно содержать указанные ниже заголовки, так как они участвуют в формировании DKIM-подписи. В случае их отсутствия письмо примется и молча погибнет.

```
Message-Id
Date
From
To
Subject
MIME-Version
Content-Type
```

## Ошибки при отправке через SMTP-гейт

Успешная SMTP-сессия прошла и принятие нами задания не гарантирует отправки письма адресату. После обработки полученного задания (письма) в логе доставки могут быть следующие ошибки.

### Проблемы с формированием письма

635 6.7.8 issue is blocked <br/>
635 6.7.8 error/sender/unknown <br/>
635 6.7.8 error/sender/onmoderation <br/>
635 6.7.8 error/sender/prohibited <br/>
635 6.7.8 no To: <br/>
635 6.7.8 no From: <br/>
635 6.7.8 no Subject: <br/>
635 6.7.8 no email in From: <br/>

### Проблемы с адресом получателя

550 5.0.0 Email has permanent delivery errors <br/>
550 5.0.0 Email is in the account stoplist <br/>

[SMTP-коды: подборка и описание](https://docs.sendsay.ru/integrations/smtp-reply-codes)

Посмотреть 100 последних ошибок в SMTP-гейте можно в АПИ-консоли с помощью запроса:
<!-- prettier-ignore -->
```js
{
	"filter": [{
		"a": "delivstream.status",
		"v": "bounced",
		"op": "=="
	}, {
		"a": "delivstream.source",
		"op": "==",
		"v": "1"
	}],
	"action": "stat.uni",
	"select": ["delivstream.to", "delivstream.dt", "delivstream.msg"],
	"first": 100,
	"order": ["-delivstream.dt"]
}
```
