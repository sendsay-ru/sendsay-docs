---
sidebar_position: 3
sidebar_label: 'Как получить статистику'
---

# Базовые представления о получении статистики через stat.uni

[Универсальная статистика](https://sendsay.ru/api/api.html#Универсальная-статистика) позволяет получить информацию про переходы, открытия писем, тиражи выпусков и&nbsp;результаты доставки выпусков рассылок. Все представленные ниже примеры вы&nbsp;можете проверить самостоятельно в&nbsp;API-консоли, при необходимости изменив под ваши конкретные нужды.

### Статистика по выпуску

Статистика по&nbsp;выпуску, которую вы&nbsp;видите в&nbsp;веб-интерфейсе Sendsay, получена из&nbsp;кэшированных данных&nbsp;&mdash; поэтому вы&nbsp;получаете эти сведения моментально.

Рассмотрим получение данных со&nbsp;всей базовой информацией по&nbsp;отправленным email-выпускам&nbsp;&mdash; например, за&nbsp;декабрь 2022&nbsp;года:

<!-- prettier-ignore -->
```js
{
	"action": "stat.uni",
	"result": "response",
	"select": ["issue.id", "issue.name", "issue.subject", "issue.dt:Ys", "issue.group.gid", "issue.group.name", "issue.members", "issue.deliv_ok", "issue.deliv_bad", "issue.readed", "issue.u_readed", "issue.clicked", "issue.u_clicked", "issue.unsubed"],
	"filter": [{
		"a": "issue.dt:Ys",
		"op": ">=",
		"v": "2022-12-01 00:00:00"
	}, {
		"a": "issue.dt:Ys",
		"op": "<=",
		"v": "2022-04-31 23:59:59"
	}, {
		"a": "issue.format",
		"op": "==",
		"v": "e"
	}],
	"order": ["-issue.dt:Ys"]
}
```

Статистика по&nbsp;выпускам заранее посчитана&nbsp;&mdash; и&nbsp;при необходимости вы&nbsp;можете запросить данные по&nbsp;всем отправленным выпускам за&nbsp;весь срок жизни вашего аккаунта.

А&nbsp;чтобы, например, узнать количество отправленных писем с&nbsp;PDF-вложениями за&nbsp;конкретный период, можно получить количество отправленных писем с&nbsp;разбивкой по&nbsp;значению поля `issue.features`:

<!-- prettier-ignore -->
```js
{
    "action": "stat.uni",
    "select": [
        "issue.features",
        "sum(issue.members)"
    ],
    "filter": [
        {
            "a": "issue.dt:YM",
            "op": "==",
            "v": "2022-12"
        },
        {
            "a": "issue.format",
            "op": "==",
            "v": "e"
        }
    ]
}
```

С&nbsp;помощью этого запроса вы&nbsp;получите количество отправленных email-выпусков за&nbsp;декабрь 2022&nbsp;года. Полный набор и&nbsp;описание полей, описывающих выпуск рассылки `issue.*`, есть [в&nbsp;документации](https://sendsay.ru/api/api.html#Информация-o-выпуске).

### Статистика для конкретного получателя

В&nbsp;отличие от&nbsp;статистики по&nbsp;выпуску, данные по&nbsp;конкретному получателю рассылок собираются и&nbsp;отдаются &laquo;на&nbsp;лету&raquo;&nbsp;&mdash; в&nbsp;момент выполнения запроса.

Данные о каждом типе событий хранятся каждая в своей области:

- [доставка](https://sendsay.ru/api/api.html#Информация-о-доставке-и-прочих-свойствах-каждого-сообщения),
- [открытия](https://sendsay.ru/api/api.html#Информация-об-открытии-писем),
- [клики](https://sendsay.ru/api/api.html#%Информация-о-переходах),
- [отписки и жалобы](https://sendsay.ru/api/api.html#Информация-об-отписке).

Нельзя в&nbsp;одном запросе добавить в `select` параметры, описывающие разные события.

Далее приведём примеры.

#### Все выпуски, отправленные за сегодня для конкретного емейла

<!-- prettier-ignore -->
```js
{
    "action": "stat.uni",
    "result": "response",
    "select": [
        "deliv.member.email",
        "deliv.issue.id",
        "deliv.issue.name",
        "deliv.issue.dt",
        "deliv.status"
    ],
    "filter": [
        {
            "a": "deliv.member.email",
            "op": "==",
            "v": "my@secret.email"
        },
        {
            "a": "deliv.issue.dt:YD",
            "op": "==",
            "v": "CURRENT"
        }
    ]
}
```

#### Количество кликов по каждой ссылке за сегодня для конкретного емейла

<!-- prettier-ignore -->
```js
{
    "action": "stat.uni",
    "result": "response",
    "select": [
        "click.member.email",
        "click.issue.id",
        "click.link.url",
        "count(*)"
    ],
    "filter": [
        {
            "a": "click.member.email",
            "op": "==",
            "v": "my@secret.email"
        },
        {
            "a": "click.issue.dt:YD",
            "op": "==",
            "v": "CURRENT"
        }
    ]
}
```

Если убрать из массива `filter` запроса объект, ограничивающий результаты конкретным емейлом, то в результате будут выведены все адреса, попадающие под оставшиеся условия запроса.

:::tip Важно
Общее количество строк в&nbsp;результате выполнения запроса не&nbsp;лимитируется, однако отправляемые запросы должны соответствовать [базовым лимитам](https://sendsay.ru/api/api.html#Базовые-лимиты_вызовов).
:::

### Вывод результата запроса

Результат запроса к `stat.uni` вы&nbsp;можете получить синхронно&nbsp;&mdash; в&nbsp;ответе на&nbsp;сам запрос, а&nbsp;также ассинхронно,&nbsp;&mdash; сохранив результат в&nbsp;файле.

Выбранный способ вывода зависит от&nbsp;предполагаемого времени выполнения запроса и&nbsp;количества строк в&nbsp;результате. В&nbsp;целом, ничего не&nbsp;мешает вывести в&nbsp;браузере сотню тысяч строк результата, но&nbsp;жизнь брокера будет зависеть только от&nbsp;мощности вашего компьютера.

За&nbsp;результат выполнения запроса отвечает параметр `result`. В&nbsp;примерах выше ожидается синхронный ответ, и&nbsp;при выполнении запроса в&nbsp;API-консоли вы&nbsp;увидите результат на&nbsp;экране.

Если&nbsp;же вы&nbsp;трезво оцениваете сложность запроса и&nbsp;решили сохранить результат в&nbsp;файле, то&nbsp;вам стоит воспользоваться [возможностями настройки параметра result API-запроса](https://sendsay.ru/api/api.html#Возвращаемое-значение).

#### Сохранить в Файлы -> Отчеты -> stat.uni

<!-- prettier-ignore -->
```js
"result": "save"
```

#### Сохранить результат запроса на внешний FTP в utf8

<!-- prettier-ignore -->
```js
"result": [{
	"to": "ftp://login:password@ftp.yourserver/path/",
	"filename": "Clients",
	"format": "csv",
	"type": "url_file",
	"utf8": "1"
}]
```

### Последовательность работы запроса stat.uni

1. Сервер находит все строки, подходящие под условия, указанные в `filter`.
2. Если указан `order`, то найденные строки сортируются по указанному правилу. Если порядок не указан, то данные выведутся без сортировки, каждый раз по-разному.
3. Если указан `skip`, то из вывода исключается указанное количество найденных строк.
4. Если указан `first`, то выводится указанное количество строк; если не указан — выводятся все найденные строки.
